generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url = env("DATABASE_URL")
}

// Models adapted for SQLite provider.
model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  role      String   @default("USER")
  verified  Boolean  @default(false)
  blocked   Boolean  @default(false)
  orders    Order[]  @relation("UserOrders")
  addresses String   @default("[]") // JSON string for array of strings
  phone     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ensure the inverse relation is defined on Order (see below)


model Pizza {
  id          String   @id @default(cuid())
  name        String
  description String
  image       String?
  basePrice   Int
  sizes       String   // JSON string: { small: 199, medium: 299, large: 399 }
  toppings    String   // JSON string: array of topping objects
  category    String
  popular     Boolean  @default(false)
  available   Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Order {
  id        String    @id @default(cuid())
  user      User      @relation("UserOrders", fields: [userId], references: [id])
  userId    String
  items     String   // JSON string
  total     Int
  payment   String
  // Status flow: PENDING -> CONFIRMED -> PREPARING -> BAKING -> OUT_FOR_DELIVERY -> DELIVERED or CANCELLED
  status    String   @default("PENDING")
  // Timestamps for each status transition
  confirmedAt DateTime?
  preparingAt DateTime?
  bakingAt DateTime?
  outForDeliveryAt DateTime?
  deliveredAt DateTime?
  cancelledAt DateTime?
  address   String
  phone     String
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}

model Coupon {
  id        String   @id @default(cuid())
  code      String   @unique
  discount  Int
  expiry    DateTime
  enabled   Boolean  @default(true)
  createdAt DateTime @default(now())
}

model EmailVerification {
  id        String   @id @default(cuid())
  email     String   @unique
  codeHash  String
  expiresAt DateTime
  createdAt DateTime @default(now())
}


